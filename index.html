<html lang="en">
	<head>
		<meta charset=utf-8>
		<title>Aggredex</title>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="icon" type="image/png" href="img/favicon.png" />
		<link rel="stylesheet" href="css/core.css" />


		<script src="js/jquery-3.3.1.min.js"></script>
		<script src="js/three.min.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/Stats.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/THREEx.KeyboardState.js"></script>
		<script src="js/THREEx.FullScreen.js"></script>
		<script src="js/THREEx.WindowResize.js"></script>
		<script src="js/Tween.js"></script>


		<!-- This is working -->
		<script src="js/renderers/CSS3DRenderer.js"></script>


		<script src="js/html-imports.min.js"></script>
		<link rel="import" href="assets/test.html">


		<script>
		$(function(){
			$("#ui").load("assets/ui/ui.html");
		});
		</script>




	</head>
	<body>
		<div id="ThreeJS" style="position: absolute; left:0px; top:0px"></div>
		<div id="ui"></div>

		<script>

		// Standard global variables
		var container;
		var scene;
		var camera;
		var renderer;
		var controls;
		var stats;
		var keyboard = new THREEx.KeyboardState();
		var clock = new THREE.Clock();

		// Custom global variables
		var mesh;
		var earth;
		var luna;
		var sol;
		var labelRenderer;
		// Scale factor - All scale data is based on actual size in km, then divided by the factor set below
		var S = 1;
		// Universe - the alleged diameter of the Universe
		var U = 2.59224014949e+23;
		// BOSS - the alleged diameter of the BOSS Supercluster
		var BOSS = 9.460730473e+21;
		// Laniakea Supercluster - the alleged diameter of the Laniakea Supercluster
		var LKA = 4.730365236e+21;
		// Sol System - the alleged diameter of the Sol System
		var SOL = 1.49598e+13;

		// Start
		init();
		animate();


		function init() {
			// SCENE
			scene = new THREE.Scene();
			// CAMERA
			var SCREEN_WIDTH = window.innerWidth;
			var SCREEN_HEIGHT = window.innerHeight;
			var VIEW_ANGLE = 45;
			var ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT;
			var NEAR = 0.1 / S;
			var FAR = U / S;
			camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
			scene.add(camera);
			camera.position.set(5000000 / S,10000,-20000);
			camera.lookAt(scene.position);


			// RENDERER
			if ( Detector.webgl ) {
				renderer = new THREE.WebGLRenderer( {antialias:true} );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );

				renderer.shadowMapEnabled = true;
				renderer.shadowMapType = THREE.PCFSoftShadowMap;
			} else {
				renderer = new THREE.CanvasRenderer();
				renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
				container = document.getElementById( 'ThreeJS' );
				container.appendChild( renderer.domElement );
			}

			// EVENTS
			THREEx.WindowResize(renderer, camera);
			THREEx.FullScreen.bindKey({ charCode : 'm'.charCodeAt(0) });

			// CONTROLS
			controls = new THREE.OrbitControls( camera, renderer.domElement );

			// LIGHT
			var light = new THREE.PointLight(0xffffff, 1.5, 5906292480 / S);
			light.position.set(0,0,0);
			scene.add(light);


			// SKYBOX

			var imagePrefix = "img/sky/space_";
			var directions  = ["xpos", "xneg", "ypos", "yneg", "zpos", "zneg"];
			var imageSuffix = ".png";
			var skyGeometry = new THREE.CubeGeometry( U / S, U / S, U / S );

			var materialArray = [];
			for (var i = 0; i < 6; i++)
				materialArray.push( new THREE.MeshBasicMaterial({
					map: THREE.ImageUtils.loadTexture( imagePrefix + directions[i] + imageSuffix ),
					side: THREE.BackSide

				}));
			var skyMaterial = new THREE.MeshFaceMaterial( materialArray );
			var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
			//scene.add( skyBox );

			// Helpers
			axes = new THREE.AxesHelper(SOL / S);
			helper = new THREE.GridHelper(SOL / S, 10,0xFFFFFF,0x00FF00);
			lec = new THREE.GridHelper(LKA / S, 10,0xFFFFFF,0x0000FF);
			boss = new THREE.GridHelper(BOSS / S, 10,0xFFFFFF,0xFF0000);
			uni = new THREE.GridHelper(U / S, 10,0xFFFFFF,0x6600cc);
			helper.setColors(0x0000ff, 0x808080);
			scene.add(axes);
			scene.add(helper);
			scene.add(lec);
			scene.add(boss);
			scene.add(uni);
			helpers = 0

			// Load 3D assets
			$.getScript("assets/index.js", function() {
				// Stars
				stellarData();
				// Planets and other planetary bodies
				planetaryData();
			});

		}

		// CONTROL RULES
		$.getScript("assets/nav/index.js", function() {
			// repeater keypress listener
			keyData();
		});


		function animate()
		{
			TWEEN.update();
			requestAnimationFrame( animate );
			render();
			update();
		}

		function update()
		{
			controls.update();
		}

		function render()
		{
			renderer.render( scene, camera );
		}

		</script>
	</body>
</html>
